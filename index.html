<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive OS Disk Scheduling Algorithm Visualizer">
    <title>OS Disk Scheduling Simulator</title>

    <!-- CSS Files -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/animations.css">

    <!-- External Libraries for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="app-container">

        <!-- ========================
             SIDEBAR (COLUMN 1)
             Contains all Controls and Info
             ======================== -->
        <div class="sidebar">

            <!-- 1. CONTROLS (MOVED INSIDE) -->
            <header class="control-panel">
                <div class="header-title">
                    <h1>üñ•Ô∏è OS Disk Scheduling Simulator</h1>
                    <p>Visualization of Disk Algorithms</p>
                </div>

                <div class="control-grid">

                    <!-- =================================== -->
                    <!-- STATE 1: CONFIGURATION (Visible)    -->
                    <!-- =================================== -->
                    <div id="config-panel">
                        <!-- Row 1: Algorithm Selection & Parameters -->
                        <div class="control-row">
                            <div class="control-group">
                                <label for="algorithmSelect">Algorithm:</label>
                                <select id="algorithmSelect">
                                    <option value="fcfs">FCFS (First Come First Serve)</option>
                                    <option value="sstf">SSTF (Shortest Seek Time First)</option>
                                    <option value="scan">SCAN (Elevator Algorithm)</option>
                                    <option value="cscan">C-SCAN (Circular SCAN)</option>
                                    <option value="look">LOOK</option>
                                    <option value="clook">C-LOOK (Circular LOOK)</option>
                                </select>
                            </div>

                            <div class="control-group">
                                <label for="initialHeadPosition">Initial Head:</label>
                                <input type="number" id="initialHeadPosition" value="53" min="0" placeholder="e.g., 53">
                            </div>

                            <div class="control-group">
                                <label for="maxTrackNumber">Max Track:</label>
                                <input type="number" id="maxTrackNumber" value="199" min="10" placeholder="e.g., 199">
                            </div>
                        </div>

                        <!-- Row 2: Request Queue & Direction -->
                        <div class="control-row">
                            <div class="control-group full-width">
                                <label for="requestQueue">Request Queue (comma-separated):</label>
                                <input type="text" id="requestQueue" value="98, 183, 37, 122, 14, 124, 65, 67" placeholder="e.g., 98, 183, 37...">
                            </div>
                            
                            <div id="directionGroup" class="control-group direction-group" style="display: none;">
                                <label>Direction (for SCAN/LOOK):</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="direction" value="low" checked>
                                        Towards 0 (Low)
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="direction" value="high">
                                        Towards Max (High)
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Run Button -->
                        <div class="control-row">
                            <!-- NOTE: This 'runBtn' ID is likely used by your controller.js to start the simulation -->
                            <button id="runBtn" class="btn btn-primary" title="Run the simulation" style="width: 100%;">
                                <span class="btn-icon">‚ñ∂Ô∏è</span>
                                <span class="btn-text">Run Simulation</span>
                            </button>
                        </div>
                    </div>

                    <!-- =================================== -->
                    <!-- STATE 2: SIMULATION (Hidden)        -->
                    <!-- =================================== -->
                    <div id="simulation-panel" style="display: none;">

                        <!-- Row 3: Animation Controls -->
                        <div class="control-row button-row">
                            <!-- This is the new Play/Pause button. Your controller.js will need to find this ID -->
                            <button id="playPauseBtn" class="btn btn-primary" title="Play/Pause Animation">
                                <span class="btn-icon">‚è∏Ô∏è</span>
                                <span class="btn-text">Pause</span>
                            </button>

                            <button id="stepBackwardBtn" class="btn btn-secondary" title="Step Backward">
                                <span class="btn-icon">‚è™</span>
                                <span class="btn-text">Step Back</span>
                            </button>

                            <button id="stepForwardBtn" class="btn btn-secondary" title="Step Forward">
                                <span class="btn-icon">‚è©</span>
                                <span class="btn-text">Step Forward</span>
                            </button>

                            <!-- This 'resetBtn' ID is likely used by your controller.js to reset the animation to step 0 -->
                            <button id="resetBtn" class="btn btn-secondary" title="Reset Animation to Step 0">
                                <span class="btn-icon">üîÑ</span>
                                <span class="btn-text">Reset Anim</span>
                            </button>
                        </div>

                        <!-- Row 4: Speed Control & Export -->
                        <div class="control-row">
                            <div class="speed-control-group">
                                <label for="speedSlider">Animation Speed:</label>
                                <div class="speed-slider-container">
                                    <span class="speed-label">Slow</span>
                                    <input type="range" id="speedSlider" min="1" max="10" value="5" class="slider">
                                    <span class="speed-label">Fast</span>
                                </div>
                            </div>
                        </div>
                        <div class="control-row">
                            <button id="exportBtn" class="btn btn-success" title="Export to PDF" style="width: 100%;">
                                <span class="btn-icon">üìÑ</span>
                                <span class="btn-text">Export PDF</span>
                            </button>
                        </div>
                        <div class="control-row">
                            <!-- This new button resets the UI back to State 1 -->
                            <button id="resetAlgorithmBtn" class="btn btn-danger" title="Change settings and run a new simulation" style="width: 100%;">
                                <span class="btn-icon">üõ†Ô∏è</span>
                                <span class="btn-text">Reset Algorithm</span>
                            </button>
                        </div>

                        <!-- 2. INFO PANEL (MOVED INSIDE) -->
                        <aside class="information-panel">
                            <div class="info-section">
                                <h3>üìä Live Statistics</h3>
                                <div class="stats-grid">
                                    <div class="stat-box">
                                        <span class="stat-label">Current Head Position</span>
                                        <span class="stat-value" id="currentHeadPosition">0</span>
                                    </div>
                                    <div class="stat-box">
                                        <span class="stat-label">Total Head Movement</span>
                                        <span class="stat-value" id="totalHeadMovement">0</span>
                                    </div>
                                    <div class="stat-box">
                                        <span class="stat-label">Seeks Count</span>
                                        <span class="stat-value" id="seeksCount">0</span>
                                    </div>
                                    <div class="stat-box">
                                        <span class="stat-label">Average Seek Time</span>
                                        <span class="stat-value" id="averageSeekTime">0.00</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Next Target -->
                            <div class="info-section">
                                <h3>üéØ Next Target</h3>
                                <div class="next-target-box">
                                    <span id="nextTargetDisplay" class="next-target">-</span>
                                </div>
                            </div>

                            <!-- Pending Queue -->
                            <div class="info-section">
                                <h3>‚è≥ Pending Queue</h3>
                                <div class="queue-container">
                                    <div id="pendingQueue" class="queue-list">
                                        <span class="queue-empty">No requests loaded</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Serviced Order -->
                            <div class="info-section">
                                <h3>‚úÖ Serviced Order</h3>
                                <div class="queue-container">
                                    <div id="servicedQueue" class="queue-list">
                                        <span class="queue-empty">No services yet</span>
                                    </div>
                                </div>
                            </div>
                        </aside>
                    </div> <!-- End of simulation-panel -->
                </div>
            </header>

            <!-- NOTE: The <aside class="information-panel"> was moved up -->

        </div> 
        <!-- ========================
             END OF SIDEBAR (COLUMN 1)
             ======================== -->


        <!-- ========================
             VISUALIZATION PANEL (COLUMN 2)
             ======================== -->
        <section class="visualization-panel">
            <div class="visualization-header">
                <h2>Disk Scheduling Visualization</h2>
                <p id="algorithmDescription" class="algorithm-description">
                    FCFS: Serves requests in the order they arrive, without optimization.
                </p>
            </div>

            <!-- Disk Representation -->
            <div class="disk-container">
                <canvas id="diskCanvas" class="disk-canvas" width="1000" height="150"></canvas>
            </div>

            <!-- Current Action Text -->
            <div class="action-text-container">
                <p id="currentActionText" class="action-text">
                    Click "Run Simulation" to start
                </p>
            </div>

            <!-- Position vs. Time Graph -->
            <div class="graph-container">
                <h3>Position vs. Time Graph</h3>
                <canvas id="graphCanvas" class="graph-canvas" width="1000" height="300"></canvas>
            </div>

            <!-- Step Information -->
            <div class="step-info">
                <span id="currentStepDisplay">Step: 0 / 0</span>
            </div>
        </section>
        <!-- ========================
             END OF VISUALIZATION (COLUMN 2)
             ======================== -->
        
    </div> 
    <!-- ========================
         END OF APP-CONTAINER
         ======================== -->

    <!-- ========================
         JAVASCRIPT FILES
         ======================== -->

    <!-- Phase 1: State Management -->
    <script src="Javascript/state-manager.js"></script>

    <!-- Phase 2: Canvas Rendering -->
    <script src="Javascript/canvas-renderer.js"></script>

    <!-- Phase 3: Algorithm Base Class -->
    <script src="Javascript/Algorithms/algorithm-base.js"></script>

    <!-- Phase 4: Individual Algorithms -->
    <script src="Javascript/Algorithms/fcfs.js"></script>
    <script src="Javascript/Algorithms/sstf.js"></script>
    <script src="Javascript/Algorithms/scan.js"></script>
    <script src="Javascript/Algorithms/cscan.js"></script>
    <script src="Javascript/Algorithms/look.js"></script>
    <script src="Javascript/Algorithms/clook.js"></script>

    <!-- Phase 5: Controller -->
    <script src="Javascript/controller.js"></script>

    <!-- Phase 6: Main Entry Point -->
    <script src="Javascript/main.js"></script>

    <!-- 
      MODIFICATION:
      - Added new script block to handle conditional UI
    -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // UI State Panels
            const configPanel = document.getElementById('config-panel');
            const simulationPanel = document.getElementById('simulation-panel');

            // --- Control Buttons ---
            // State 1
            const runBtn = document.getElementById('runBtn');
            // State 2
            const resetAlgorithmBtn = document.getElementById('resetAlgorithmBtn');
            const playPauseBtn = document.getElementById('playPauseBtn'); // The new button
            
            // --- Direction Group Logic ---
            const algorithmSelect = document.getElementById('algorithmSelect');
            const directionGroup = document.getElementById('directionGroup');
            const scanAlgos = ['scan', 'cscan', 'look', 'clook'];

            const toggleDirectionGroup = () => {
                if (scanAlgos.includes(algorithmSelect.value)) {
                    directionGroup.style.display = 'flex';
                } else {
                    directionGroup.style.display = 'none';
                }
            };
            algorithmSelect.addEventListener('change', toggleDirectionGroup);

            // --- UI State Toggling Logic ---

            // This function switches to "Simulation View"
            // Your controller.js should call this function when the simulation is ready
            // For now, I'll attach it to the runBtn click for demonstration
            const showSimulationView = () => {
                configPanel.style.display = 'none';
                // *** THIS IS THE FIX ***
                // Change from 'flex' to 'block'. This will allow the
                // children elements to stack vertically as intended.
                simulationPanel.style.display = 'block'; 
                
                // Also update the 'runBtn' to 'playPauseBtn'
                // We'll just manage visibility
                playPauseBtn.innerHTML = '<span class="btn-icon">‚è∏Ô∏è</span><span class="btn-text">Pause</span>';
            };

            // This function switches back to "Config View"
            const showConfigView = () => {
                simulationPanel.style.display = 'none';
                configPanel.style.display = 'block'; 
            };

            // --- Event Listeners ---
            
            // IMPORTANT: Your controller.js probably already has a listener on 'runBtn'.
            // You should MOVE this logic inside your controller's 'runBtn' listener.
            // This is just a placeholder to show how it works.
            runBtn.addEventListener('click', () => {
                // Your simulation generation code from controller.js goes here first...
                // ... then, once the simulation is ready, you call this:
                showSimulationView();
            });

            resetAlgorithmBtn.addEventListener('click', () => {
                // This button should also probably tell your controller to reset everything
                // before switching the view.
                showConfigView();
                // You might also need to clear canvases and reset states here.
            });

            // Example of play/pause toggle
            let isPlaying = true;
            playPauseBtn.addEventListener('click', () => {
                isPlaying = !isPlaying;
                if (isPlaying) {
                    playPauseBtn.innerHTML = '<span class="btn-icon">‚è∏Ô∏è</span><span class="btn-text">Pause</span>';
                    // Add logic from your controller to resume animation
                } else {
                    playPauseBtn.innerHTML = '<span class="btn-icon">‚ñ∂Ô∏è</span><span class="btn-text">Play</span>';
                    // Add logic from your controller to pause animation
                }
            });
        });
    </script>

</body>
</html>

